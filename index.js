(function () {var b={};Object.defineProperty(b,"__esModule",{value:!0});var f={name:"tabs",props:{defaultIndex:{default:0,type:Number},onSelect:{type:Function}},data:function(){return{selectedIndex:this.defaultIndex}},methods:{switchTab:function(t,e,a){a||(this.selectedIndex=e,this.onSelect&&this.onSelect(t,e))}},render:function(){var t=this,e=arguments[0],a=this.$slots.default.filter(function(t){return t.componentOptions}),s=[];return a.forEach(function(a,r){var $=a.componentOptions.propsData,l=$.title,n=$.titleSlot,o=$.disabled,i=n?t.$slots[n]:l,f=!0===o||""===o;s.push(e("li",{class:"vue-tab",attrs:{role:"tab","aria-selected":t.selectedIndex===r?"true":"false","aria-disabled":f?"true":"false"},on:{click:function(e){return t.switchTab(e,r,f)}}},[i]))}),e("div",{class:"vue-tabs",attrs:{role:"tabs"}},[e("ul",{class:"vue-tablist",attrs:{role:"tablist"}},[this.$slots.left,s,this.$slots.right]),a[this.selectedIndex]])}},g={name:"tab",props:["title","titleSlot","disabled"],render:function(){return(0,arguments[0])("div",{class:"vue-tabpanel",attrs:{role:"tabpanel"}},[this.$slots.default])}};function k(t){t.component(f.name,f),t.component(g.name,g)}var h=f;b.Tabs=h;var i=g;b.Tab=i;var j=k;b.install=j;var e={name:"IssuePreview",props:{data:String}};if(typeof e==="function"){e=e.options}Object.assign(e,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm.data?_c("k-textarea-field",{attrs:{"label":"Preview","value":_vm.data,"buttons":false,"disabled":""}}):_c("k-text",[_vm._v(_vm._s(_vm.$t("reporter.tab.preview.empty")))])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var a={name:"IssueForm",components:{IssuePreview:e,Tabs:h,Tab:i},props:{fields:{type:Object},previewData:{type:String}},computed:{hasResponse(){return Object.keys(this.response).length>1},buttonIcon(){return this.loading?"loader":"check"},successMessage(){return this.$t("reporter.form.success",{issueLink:this.issueLink})},issueLink(){const e=this.response.issueUrl,s=this.response.issueId;return this.$t("reporter.form.issue.link",{issueLink:e,issueId:s})}},data:()=>({errors:[],response:{},loading:!1,previewClicked:!1,dirty:!0,previewData:{},issue:{title:null,formFields:{}}}),mounted(){const e=this.$el.querySelectorAll(".vue-tab")[1];e.addEventListener("click",()=>{this.previewClicked&&this.loadPreview(),this.previewClicked=!0}),e.addEventListener("mouseenter",()=>{this.dirty&&this.loadPreview()}),this.$el.querySelectorAll(".vue-tab")[0].addEventListener("click",()=>{this.dirty=!1,this.previewClicked=!1})},methods:{somethingChanged(){this.dirty=!0},loadPreview(){this.$api.post("reporter/report?preview=true",this.issue).then(e=>{this.previewData=e,this.dirty=!1})},checkForm(){this.errors=[],!this.issue.title&&this.issue.title<3&&this.errors.push(this.$t("reporter.form.error.title")),this.errors.length||this.submit()},submit(){this.loading=!0;const e=this.$api.post("reporter/report",this.issue);e.then(e=>{e.status>=200&&e.status<300?(this.response=e,this.issue={},this.$store.dispatch("notification/success",":)")):401===e.status?(this.errors.push(this.$t("reporter.form.error.authFailed")),this.response={}):400===e.status?(this.errors.push(e.message),this.response={}):404===e.status?(this.errors.push(this.$t("reporter.form.error.repoNotFound")),this.response={}):501===e.status?(this.errors.push(this.$t("reporter.form.error.platform.unsupported")),this.response={}):this.response={},this.loading=!1}),e.catch(e=>{this.errors.push(this.$t(e.message)),this.loading=!1,this.response={}})}}};if(typeof a==="function"){a=a.options}Object.assign(a,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",{staticClass:"k-kit-form",on:{"input":function($event){return _vm.somethingChanged()}}},[_vm.errors.length?_c("k-box",{staticClass:"k-kit-form--note",attrs:{"theme":"negative"}},[_c("k-icon",{attrs:{"type":"alert"}}),_vm._l(_vm.errors,function(error){return _c("p",[_vm._v(_vm._s(error))])})],2):_vm._e(),_vm._v(" "),_vm.hasResponse?_c("k-box",{staticClass:"k-kit-form--note",attrs:{"theme":"positive"}},[_c("k-icon",{attrs:{"type":"check"}}),_c("p",{domProps:{"innerHTML":_vm._s(_vm.successMessage)}})],1):_vm._e(),_vm._v(" "),_c("k-form",[_c("k-grid",{staticClass:"title-field"},[_c("k-column",[_c("k-text-field",{attrs:{"name":"title","label":_vm.$t("reporter.form.field.title"),"required":""},model:{value:_vm.issue.title,callback:function($$v){_vm.$set(_vm.issue,"title",$$v)},expression:"issue.title"}})],1)],1),_vm._v(" "),_c("tabs",[_c("tab",{attrs:{"title":_vm.$t("reporter.tab.write")}},[_c("k-fieldset",{attrs:{"fields":_vm.fields},on:{"submit":function($event){$event.preventDefault();return _vm.checkForm($event)}},model:{value:_vm.issue.formFields,callback:function($$v){_vm.$set(_vm.issue,"formFields",$$v)},expression:"issue.formFields"}})],1),_vm._v(" "),_c("tab",{attrs:{"title":_vm.$t("reporter.tab.preview")}},[_c("issue-preview",{attrs:{"data":_vm.previewData}})],1)],1),_vm._v(" "),_c("k-line-field"),_vm._v(" "),_c("k-button",{class:{"is-loading":_vm.loading},attrs:{"disabled":_vm.loading,"icon":_vm.buttonIcon},on:{"click":_vm.checkForm}},[_vm._v(_vm._s(_vm.$t("reporter.form.button.save")))])],1)],1)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var c={components:{IssueForm:a},props:{fields:Object},data:()=>({fields:{}}),async created(){this.$api.get("reporter/fields").then(e=>{this.fields=e})}};if(typeof c==="function"){c=c.options}Object.assign(c,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("k-view",{staticClass:"k-issue-tracker-view"},[_c("k-header",[_vm._v(_vm._s(_vm.$t("reporter.headline")))]),_vm._v(" "),_c("k-text",[_vm._v(_vm._s(_vm.$t("reporter.description")))]),_vm._v(" "),_c("issue-form",{attrs:{"fields":_vm.fields}})],1)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var d={components:{IssueForm:a},props:{fields:Object,headline:String},data:()=>({fields:{}}),async created(){this.$api.get("reporter/fields").then(e=>{this.fields=e})}};if(typeof d==="function"){d=d.options}Object.assign(d,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("section",[_c("header",{staticClass:"k-section-header"},[_c("k-headline",[_vm._v(" "+_vm._s(_vm.headline)+" ")])],1),_vm._v(" "),_c("issue-form",{attrs:{"fields":_vm.fields}})],1)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());panel.plugin("gearsdigital/kirby-reporter",{views:{reporter:{component:c,icon:"bug"}},sections:{reporter:d}});})();